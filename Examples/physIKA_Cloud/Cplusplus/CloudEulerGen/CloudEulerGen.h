#pragma once

#include<iostream>
#include<vector>
#include<string>

//????????????1
#define GRID_LENGTH 1
//?§Ø????????????????????
#define MATERIAL_MIN 1e-6

/*??????????????????*/
//????????????/??§³???
#define MAX_AMBIENT_TEMP 25.0
#define MIN_AMBIENT_TEMP 5.0
//???????????????
#define INIT_VAPOR_DENSITY 1.0f
//???????????????
#define INIT_MATERIAL_TEMP 15.0
//?????????????????????
#define INIT_VELOCITY_W 0.3

class CloudEulerGen
{
public:
	CloudEulerGen(const std::vector<int>& arg, const float epsilon);
	~CloudEulerGen();

	//?????????????????????(???????§Õ???)
	void CloudGenFinalRun(int times);
	//????demo????????()
	void CloudGenFrameRun();

	const int GetModeFlag();
	const int GetN();
	const float GetVelocityU(int i, int j, int k);
	const float GetVelocityV(int i, int j, int k);
	const float GetVelocityW(int i, int j, int k);
	const float GetVaporDensity(int i, int j, int k);
	const float GetCloudDensity(int i, int j, int k);
	const float GetAmbientTemp(int k);
	const float GetMaterialTemp(int i, int j, int k);
	const int GetFrameCount();

private:
	int mode_flag_;   //??????(0-??,1-?????????)

	/* ?????????????? */
	int n_;  //??????§³(?????????)
	int start_x_;  //????????x????
	int end_x_;  //?????????x????
	int start_y_;  //????????y????
	int end_y_;  //?????????y????
	int noise_type_;  //????????
	float epsilon_;  //???????????
	/*------------------*/

	float init_vapor_density_;  //???????????
	float init_material_temp_;  //????????????
	float init_velocity_w_;  //??????????????

	int size_;
	float dt_;   //?????
	int frame_count_;   //?????????§Ö?????

	std::vector<float> velocity_u_;   //x???????
	std::vector<float> velocity_v_;   //y???????
	std::vector<float> velocity_w_;   //z???????
	std::vector<float> vapor_density_;  //??????
	std::vector<float> cloud_density_;  //?????
	std::vector<float> ambient_temp_;  //???????
	std::vector<float> material_temp_;  //???????

	//??????????¦Ë???????????????
	const int Position(int i, int j, int k);
	//????????
	void GetVelocity();
	//????????
	void GetDensity();
	//??????(value:??????????  velocity_project_flag:????????(0-?????1-x??2-y??3-z??)
	void BoundaryCondition(std::vector<float>& value, const int velocity_project_flag);
	//Advect???(??????????????????????????????????????????)
	void Advect(std::vector<float>& value, const std::vector<float>& pre_value, const std::vector<float>& velocity_u, const std::vector<float>& velocity_v, const std::vector<float>& velocity_w);
	//????????????
	void GaussSeidelIteration(std::vector<float>& p, const std::vector<float>& div);
	//Project??
	void Project();
	//AddBouyancySmoke?????
	void AddBouyancySmoke();
	//AddBouyancyCloud?????
	void AddBouyancyCloud();
	//VorticityConfinement????????
	void VorticityConfinement();
	//PhaseTransitionCloud?????
	void PhaseTransitionCloud();
	//CorrectTimestep?????????(????????)
	void CorrectTimestep();
	//SourceControl?????
	void SourceControl();
	//NoneNoise???????
	void NoneNoise();
	//GaussNoise????????
	void GaussNoise();
};

